# 第5章 並行性

#### 感想・気づき

- 「複数のデータベーストランザクション間で処理されるデータの並行性を制御することを「**オフライン並行性**」と呼ぶ」
    - 改めて読んで、新しい発見だった
- 並行性の問題を見ると、まだまだ管理が難しいものの1つだなと言う感じ
    - これを理解して、管理できる人は一握りなんだろうなってイメージ

- オフライン並行性/アプリケーションサーバの並行性と並行性にも複数の種類があることを今まで意識していなかった
    - モバイルアプリだとUI動作を制御する部分をメインスレッドとして、UIの更新などに時間がかかる時にサブスレッドで処理したりするがそのような並行性は本章で紹介されている並行性とはまた別の並行性だと感じた

#### 疑問

## 並行性の問題

#### 感想・気づき

#### 疑問

- 並行性に関するトレードオフ項目はたくさんあるけど、みんな洗い出してから判断しているのかな?

## 実行コンテキスト

| 用語 | 意味 |
|----|----|
| リクエスト | ソフトウェアが動作する外側の世界からの呼び出し<br>通常はリクエストに対してレスポンスを返す |
| セッション | クライアントとサーバが一定時間内に相互作用すること<br>接続から切断までの一連のインタラクティブな処理を指す |
| プロセス | OSが管理する実行コンテキストで、各プロセスで扱う内部データは分離される<br>プロセスは1つ以上のスレッドを持つ |
| スレッド | 1つのプロセスから生成される実行単位で、1つのプロセスに複数のスレッドを持つことが出来る<br>同一プロセス内の内部データは共有される |

#### 感想・気づき

- コンテキストの定義は自分でも再認識出来てよかった
- 用語の部分は整理になった
    - このあたりの用語を前程に話さないと全く話が噛み合わなそう

- 普段の開発ではプロセスをあまり意識していないが定義とともに再確認できた


#### 疑問

## 分離性および不変性

#### 感想・気づき

- 確かに並行性の問題は排他問題がほとんどで、分離性と不変性で対処するな
- 並行性によって発生する課題と対処があっていない時はここからスタートしないといけないな

- 分離性と不変性をきちんと認識していないと不必要に複雑だったり、パフォーマンスが悪化してしまいそう

#### 疑問

## 軽い並行性制御および重い並行性制御

#### 感想・気づき

- 楽観ロックと悲観ロック考え方は面白い
    - 昔は悲観ロックで今は楽観ロックで解決しようとしているイメージ

- 悲観ロックは対象を選ばないとユーザビリティが下がる
    - 会社の文書管理システムの1つが悲観ロックを採用しているが、なかなかチェックアウトできないと辛い

#### 疑問

### 一貫性のない読み込み防止

#### 感想・気づき

- 楽観ロックと悲観ロックの選択はITリテラシーの問題かなぁ

#### 疑問

### デッドロック

#### 感想・気づき

#### 疑問

## トランザクション

#### 感想・気づき

- DBの話か
    - 銀行システムはイベントソーシングを使っていると思うから、データのRead/Write時点でロックが必要っぽい
- DBにデータを登録する前のトランザクションとロックは慎重に考えないといけないな
    

#### 疑問

- 銀行システムはこのあたりのロック時間を短くするために簡単に借金できる機能をもたせているのかな

### ACID

#### 感想・気づき

- この特性を読むたびに悲観ロックって楽でいいなと思っている

#### 疑問

### トランザクション可能なリソース

#### 感想・気づき

#### 疑問

### 即応性に対するトランザクション分離性の制限

- 繰り返し可能な読み込みとコミットされた読み込みに関して、読み込みの精度と即応性が比例していないのは面白い
- 実際のシステムでは直列可能な読み込みとコミットされた読み込みを実現することが多いのかな

#### 感想・気づき

#### 疑問

### ビジネストランザクションとシステムトランザクション

| 用語 | 意味 |
|----|----|
| ビジネストランザクション | 実世界におけるトランザクション |
| システムトランザクション | コンピュータシステムにおけるトランザクション<br>アプリケーションとアプリケーションがアクセスする共有資源の観点から処理単位を考える<br>システムで共有される状態を、ある一貫した状態から別の一貫した状態へと変換することを保証する細分化できない作業単位 |

#### 感想・気づき

- ビジネストランザクションとシステムトランザクションの説明を見るとなかなか難しいなと
    - DDDをやっている場合、どの段階でシステムトランザクションに切り替えれば良いのかと

#### 疑問

## オフライン並行性制御のためのパターン

| パターン | 説明 |
|----|----|
| 軽オフラインロック | 楽観ロックを用いたオフライン並行性の実現 |
| 重オフラインロック | 悲観ロックを用いたオフライン並行性の実現 |
| 緩ロック | 複数のオブジェクトのロックをまとめて1つで管理する |
| 暗黙ロック | フレームワークがロック管理を行う |

#### 感想・気づき

- ロックの分類は面白い
- このあたりは共通言語で話せるようになりたい

#### 疑問

## アプリケーションサーバの並行性

#### 感想・気づき

- 1セッション1プロセス/1スレッドを見るとクラウドシステムはいい感じで解決しているなと

#### 疑問

###### tags: `PoEAA`