# 第3章　リレーショナルデータベースへのマッピング

## タイムテーブル

| 時間 | 所要時間 | 内容 |備考 |
| --------  | -------- | -------- | -------- |
| 20:00-20:15  | 15分   | 感想記入&HackMDに書かれた皆さんの感想・気づき・疑問をもっと掘り下げたいものを、 :+1: 付けていく  |      |
| 20:15-21:55   | 100分  | 本の節ごとにディスカッション（ここでも適宜、HackMDに気づきとか書いていってもらっていいです）     |    |
|21:55-22:00 | 5分 | 次回開催日と読む範囲決めてクローズ | |
|21:55-22:00 | 5分 | 次回開催日と読む範囲決めてクローズ | |


---

## 概要

### 感想・気づき

- あとに出てくるパターンの概要説明の章のイメージ
- Blikiに要点を押さえた説明があるので、参考に見るのも良いかも
- 現在のシステムにおいて、データベースはリレーショナルデータベースを指すことが多い
    - OracleとIBMの戦略が成功したんだな
    - OODBへの言及も、OODB自体というより、ベンダの強さによるもの、的な說明（3.1）
- ここで主張されていることはほぼ同意
    - マーチン・ファウラーとボブおじも同じ意見っぽい

### 疑問

## アーキテクチャに関するパターン

### 感想・気づき

- あとの章で詳細に説明があるので、ここではかなり簡素に説明されているので理解が追いつかなかった
- システムの規模や特性でデータベースの操作方法がまとめられているので、理解が進んだ
- ここを読むとActive Recordパターンの思想は妥当なイメージ
    - Railsが批判されている意味がわからなくなってきた
    - 「なんでもRails」からの揺り戻しで「なんでも not Rails」になってそうな印象が、正直強い
    - あらゆる層で ActiveRecord を使うのはギルティ
    - 初学者が[Getting Started with Rails](https://guides.rubyonrails.org/getting_started.html)からスタートするので失敗しやすい
        - フレームワークはドメインの特性を考慮していない
- ツールは導入しても失敗する
    - Whyを理解することが重要
    - ツールだけでは問題を解決しない

### 疑問

## 振る舞いに関する問題

構造的な側面を考察する場合、アーキテクチャと振る舞いの2つの側面が問題がある

- アーキテクチャについて
    - トランザクションスクリプト
    - ドメインモデル
    - テーブルモジュール
- 振る舞いについて
    - ユニットオブワーク
    - 一意マップ
    - レイジーロード

### 感想・気づき

- 急に6つのパターンが出てきたので読むのに苦労した
- 一つ一つ読んでみると解決したい課題と解決策が書かれているので、該当はつかめた感じ
- やっぱりActive Recordが悪いものに見えない
- ユニットオブワークについて
    - それ以上分解できない（分解してはいけない）振る舞いの単位を Unit of Work と呼ぶ（そしてその単位で設計する）、的な理解
    - 「不可分な仕事の単位」→ unit of work → つまりatomicityでは？


### 疑問

## データの読み込み

### 感想・気づき

- データベースを外部の詳細と捉えた場合、アクセス回数を減らすという施策は妥当に思える
    - データベースがドメインの中心にあるという考えだだと違う扱いになるイメージ

### 疑問

## 構造的なマッピングに関するパターン

### 感想・気づき

- オブジェクトとリレーショナルデータベースの比較で扱い方の概要がわかった
- 依存の方向や多重度でデータベース上では扱いが変わるという発見
- 継承構造とテーブルの関係性は興味深かった

### 疑問

- データベースの操作で困っている人はデータマッパーで困っているのかな?
    - O/Rマッパが有償、という時代背景もありそうですが
    - 今は必要に迫られてよくやるけど、まあまあつらひ

## マッピングの構築

### 感想・気づき

- リレーショナルデータベースのマッピングが分類されていたけど、これを考えながらやらないと混乱するイメージ

### 疑問

- 二重マップとか参照とかはどうやって表現しているのかな?
    - レビューで情報共有する

## メタデータの使用

### 感想・気づき

- オブジェクトとデータベースの紐付けも「どうやって分離するか」に集中しているイメージ

### 疑問

- メタデータマッピングは便利そうだけど、何かデメリットがあるのかな?
    - フレームワークに組み込まれているので意識をしない
        - JPAなどアノテーションを用意する
    - フレームワークがよしなにやってくれている
    - 仕組みを作るのは大変そう（一回作ってしまえば、感はある）
- 結合のイメージが合っているかな?
    - ドメインモデルとリポジトリ
    - リポジトリとデータベース
        - クエリオブジェクトもしくはメタデータを介して結合

## データベース接続

### 感想・気づき

### 疑問

## その他の要点

### 感想・気づき

- この後に説明することをざっと説明された感じなので理解が不十分のイメージ

### 疑問

----

## 放課後

###### tags: `PoEAA`