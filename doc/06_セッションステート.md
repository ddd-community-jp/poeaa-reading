# 第6章 セッションステート

【前回の引用】

ビジネストランザクションとシステムトランザクションの違いの根本は「**ステートレスセッション対ステートフルセッション**」の違いである

| 用語 | 意味 |
|----|----|
| ビジネストランザクション | 実世界におけるトランザクション |
| システムトランザクション | コンピュータシステムにおけるトランザクション<br>アプリケーションとアプリケーションがアクセスする共有資源の観点から処理単位を考える<br>システムで共有される状態を、ある一貫した状態から別の一貫した状態へと変換することを保証する細分化できない作業単位 |

つまり、ビジネストランザクションとは、現実世界における人が行うトランザクションを指す。一方、システムトランザクションは、システム内のトランザクション(メモリなどのリソース管理など)を指す。


## ステートレス性への価値

#### 感想・気づき

- セッションステートの明確な定義がないような
    - システムにログインしてからログアウトするまでの一連の操作をセッションと呼び
    - その一連の操作の中のそれぞれの状態をセッションステートと呼ぶ
    - Web系ではよく使う(確かに)
        - よくあるショッピンサイトだと1週間とか
            - セッションステートの実現方法で変わってくる
    - 認証セッション
        - アクセス権限を与えてから失うまで
    - セッションステートは「ステートを持っているセッション」と言いたかったのでは?
        - セッション≠状態を持つ
        - ステートレスセッションもある
- ステートレスであることはシステムとして安定はするのはわかる
    - どこかに複雑性を任せないといけないけど、今はDBになっているイメージ
    - セッションステート≠レコードデータなので↑とは言い切れないのでは
        - ファウラーはデータ指向でありオブジェクト指向
        - 状態はビジネス的に価値のあるデータ
        - セッションステートは永続化されるまでの状態
    - レコードデータに格納されたとしても状態ではない
        - トランザクションオブジェクトはメモリ上にあって揮発情報である
    - セッションステートは中間データであり、ビジネス的な価値は薄い
        - 購入したというレコードデータになって初めて価値が生まれる
        - ただのユーザーの行動記録
            - これに価値があるのであれば別だが…

#### 疑問

- >セッションステートは1つのセッションに関連した状態のため、データベースに保持されるレコードデータとは全く概念の異なるもの
    - これはセッションステートは一時的なもので、レコードデータは永続的なものという理解でいいか
    - ↑だいたいOK
    - レコードデータはビジネス的に価値があって、保存しておきたいもの

## セッションステート

#### 感想・気づき

#### 疑問

### セッションステートを格納する方法

| セッションステートパターン | 概要 |
|----|----|
| クライアントセッションステート | セッションステートをクライアント側に格納する<br>URLパラメータ、クッキー、隠しフィールド、Web Storage、Web SQL Databaseが実現手段の選択肢になる |
| サーバセッションステート | セッションステートを、サーバ側のメモリに保持する<br>直列化されたオブジェクトのような耐久性の優れた場所に格納される<br>HTTPセッション、セッションBeanが実現手段の選択肢になる |
| データベースセッションステート | セッションステートを、サーバ側のデータベースに保持する<br>サーバセッションステートの1つのパターンで、データをテーブルとフィールドに分割して管理する |

#### 感想・気づき

#### 疑問

- 今のWebシステムはどのパターンを採用することが多いんだろうか?
    - クライアントのリッチさとネットワークが太くなっていることからクライアントセッションステートのイメージ
    - トレードオフがあるので様々なパターンがある
        - ただし、揮発性の高い情報を扱うことが少ない
        - リバースプロキシサーバーのスティッキーセッションがある場合
            - 複数のアプリケーションサーバーがある場合
            - 特定のユーザーが特定のサーバーに接続できるようにする
        - クライアントサーバーのセッションもよくゲームで使う
            - ネットワークが切断されても継続して使用できるようにする
                - 必要なデータはクライアントに送る
            - ただし、ガチャ対応のため需要なものはサーバーサイドで行う
            - 重要なデータはサーバーで実施して、クライアントにできるものはクライアントで行う
                - ユーザー体験を失わないように処理を行う

###### tags: `PoEAA`